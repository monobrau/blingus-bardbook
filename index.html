<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Blingus' Bardbook</title>
  <link rel="stylesheet" href="styles.css?v=6" />
</head>
<body>
  <header class="banner">
    <div class="banner__wrap">
      <div class="crest" aria-hidden="true">âš”ï¸</div>
      <h1>Blingus' Bardbook</h1>
      <div class="crest" aria-hidden="true">ğŸ›¡ï¸</div>
    </div>
    <p class="subtitle">Iconic, humorous songâ€‘parody lines for spells, Bardic Inspiration, Vicious Mockery, and character action ideas</p>
  </header>

  <nav class="toolbar" aria-label="Controls">
    <div class="toolbar__container">
      <!-- Primary Controls Row -->
      <div class="toolbar__row toolbar__row--primary">
      <label>Section
        <select id="sectionSelect">
          <option value="spells">Spell Parodies</option>
          <option value="bardic">Bardic Inspiration</option>
          <option value="mockery">Vicious Mockery</option>
          <option value="actions">What's Your Character Doing?</option>
          <option value="criticalHits">Critical Hit Description</option>
          <option value="criticalFailures">Critical Failure Description</option>
          <option value="skillChecks">Skill Check Results</option>
        </select>
      </label>

      <label id="categoryLabel">Category
        <select id="categorySelect"></select>
      </label>

      <label class="search">
        <input id="searchInput" type="search" placeholder="Search all lyrics, songs, artists, or actions..." />
      </label>

      <button id="clearBtn" class="btn btn--secondary">Clear</button>
      </div>

      <!-- Checkbox Filters Row -->
      <div class="toolbar__row toolbar__row--filters">
      <label class="toggle">
        <input type="checkbox" id="favoritesOnly" />
        <span>Only favorites</span>
      </label>

      <label class="toggle">
        <input type="checkbox" id="darkModeToggle" />
        <span>ğŸŒ™ Dark mode</span>
      </label>
      </div>

      <!-- Action Buttons Row -->
      <div class="toolbar__row toolbar__row--actions">
      <button id="clearCacheBtn" class="btn btn--secondary btn--cache" title="Force reload and clear browser cache">ğŸ”„ Clear Cache</button>
      <button id="addEditBtn" class="btn">Add/Edit Items</button>
      <button id="manageGeneratorsBtn" class="btn">ğŸ² Manage Generators</button>
      </div>

      <!-- Generator Row (dynamically added) -->
      <div class="toolbar__row toolbar__row--generators"></div>
    </div>
  </nav>

  <main id="content" class="content" aria-live="polite"></main>

  <footer class="footer">
    <div>Tip: Click any line to copy â€¢ Star to favorite â€¢ Use the toolbar to filter (adult/favorites/search).</div>
    <div style="margin-top: 8px; font-size: 14px;">âŒ¨ï¸ Keyboard: Arrow keys to navigate, Enter to copy</div>
  </footer>

  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>

  <!-- Generator Display Modal -->
  <div id="generatorModal" class="modal" role="dialog" aria-labelledby="generatorTitle" aria-hidden="true">
    <div class="modal__content" style="max-width: 600px;">
      <div class="modal__header">
        <h2 id="generatorTitle">Generated Text</h2>
        <button class="modal__close" id="generatorModalClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal__body">
        <div id="generatorText" style="padding: 16px; font-size: 18px; line-height: 1.6; min-height: 60px; border: 2px solid var(--accent); border-radius: 6px; margin-bottom: 12px;"></div>
        <div style="display: flex; gap: 8px; justify-content: flex-end;">
          <button id="generatorCopyBtn" class="btn">Copy</button>
          <button id="generatorCloseBtn" class="btn">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div id="historyModal" class="modal" role="dialog" aria-labelledby="historyTitle" aria-hidden="true">
    <div class="modal__content" style="max-width: 700px;">
      <div class="modal__header">
        <h2 id="historyTitle">ğŸ“œ Recently Used</h2>
        <button class="modal__close" id="historyModalClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal__body">
        <div id="historyList" style="display: flex; flex-direction: column; gap: 8px; max-height: 60vh; overflow-y: auto;"></div>
      </div>
      <div class="modal__footer">
        <button id="historyCloseBtn" class="btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Generator Management Modal -->
  <div id="generatorManageModal" class="modal" role="dialog" aria-labelledby="generatorManageTitle" aria-hidden="true">
    <div class="modal__content" style="max-width: 700px;">
      <div class="modal__header">
        <h2 id="generatorManageTitle">Manage Generators</h2>
        <button class="modal__close" id="generatorManageClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal__body">
        <div style="margin-bottom: 16px;">
          <label>Generator Type
            <select id="generatorTypeSelect" style="width: 100%; padding: 8px; border: 1px solid var(--burnt); border-radius: 6px;">
              <option value="battleCries">âš”ï¸ Battle Cries</option>
              <option value="insults">ğŸ—¡ï¸ Insults</option>
              <option value="compliments">ğŸ’¬ Compliments</option>
            </select>
          </label>
        </div>
        <div style="margin-bottom: 16px;">
          <button id="addGeneratorBtn" class="btn" style="width: 100%;">â• Add New</button>
        </div>
        <div id="generatorsList" style="display: flex; flex-direction: column; gap: 8px; max-height: 400px; overflow-y: auto;"></div>
      </div>
      <div class="modal__footer">
        <button id="generatorManageCloseBtn" class="btn">Close</button>
      </div>
    </div>
  </div>

  <!-- YouTube Player Modal -->
  <div id="youtubePlayerModal" class="modal" role="dialog" aria-labelledby="youtubePlayerTitle" aria-hidden="true">
    <div class="modal__content" style="max-width: 900px;">
      <div class="modal__header">
        <h2 id="youtubePlayerTitle">ğŸµ Karaoke Track</h2>
        <button class="modal__close" id="youtubePlayerClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal__body" style="padding: 20px;">
        <div id="youtubePlayerContainer" style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; background: #000;">
          <iframe id="youtubePlayerFrame" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading="lazy"></iframe>
        </div>
        <div id="youtubeFallback" style="display: none; margin-top: 16px; text-align: center;">
          <p style="color: var(--ink); margin-bottom: 12px;">Video embedding is restricted. Open on YouTube instead?</p>
          <button id="youtubeOpenTabBtn" class="btn" style="background: #ff0000; color: white;">Open on YouTube</button>
        </div>
      </div>
      <div class="modal__footer">
        <button id="youtubePlayerCloseBtn" class="btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Generator Edit Modal -->
  <div id="generatorEditModal" class="modal" role="dialog" aria-labelledby="generatorEditTitle" aria-hidden="true">
    <div class="modal__content" style="max-width: 600px;">
      <div class="modal__header">
        <h2 id="generatorEditTitle">Add Generator Item</h2>
        <button class="modal__close" id="generatorEditClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal__body">
        <label>
          Text
          <textarea id="generatorEditText" rows="3" style="width: 100%; padding: 8px; border: 1px solid var(--burnt); border-radius: 6px; font-family: inherit;"></textarea>
        </label>
      </div>
      <div class="modal__footer">
        <button id="saveGeneratorBtn" class="btn">Save</button>
        <button id="cancelGeneratorBtn" class="btn">Cancel</button>
        <button id="deleteGeneratorBtn" class="btn" style="background: #c44; color: white; display: none;">Delete</button>
      </div>
    </div>
  </div>

  <!-- Voice Preset Modal -->
  <div id="presetModal" class="modal" role="dialog" aria-labelledby="presetModalTitle" aria-hidden="true">
    <div class="modal__content" style="max-width: 600px;">
      <div class="modal__header">
        <h2 id="presetModalTitle">Manage Voice Presets</h2>
        <button class="modal__close" id="presetModalClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal__body">
        <div style="margin-bottom: 16px;">
          <button id="saveCurrentPresetBtn" class="btn" style="width: 100%; margin-bottom: 8px;">ğŸ’¾ Save Current State as Preset</button>
        </div>
        <div id="presetsList" style="display: flex; flex-direction: column; gap: 8px; max-height: 400px; overflow-y: auto;"></div>
      </div>
      <div class="modal__footer">
        <button id="presetCloseBtn" class="btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal__content">
      <div class="modal__header">
        <h2 id="modalTitle">Add New Item</h2>
        <button class="modal__close" aria-label="Close">&times;</button>
      </div>
      <div class="modal__body">
        <label>
          Text
          <textarea id="editText" rows="3" style="width: 100%; padding: 8px; border: 1px solid var(--burnt); border-radius: 6px; font-family: inherit;"></textarea>
        </label>
        <label id="songLabel" style="display: none;">
          Song
          <input type="text" id="editSong" style="width: 100%; padding: 8px; border: 1px solid var(--burnt); border-radius: 6px; font-family: inherit;" />
        </label>
        <label id="artistLabel" style="display: none;">
          Artist
          <input type="text" id="editArtist" style="width: 100%; padding: 8px; border: 1px solid var(--burnt); border-radius: 6px; font-family: inherit;" />
        </label>
        <label id="adultLabel" style="display: none;">
          <input type="checkbox" id="editAdult" />
          <span>Adult/risquÃ©</span>
        </label>
        <div id="youtubeFields" style="display: none;">
          <label>
            YouTube URL or Video ID
            <input type="text" id="editYoutube" placeholder="https://youtube.com/watch?v=..." style="width: 100%; padding: 8px; border: 1px solid var(--burnt); border-radius: 6px; font-family: inherit;" />
          </label>
          <label>
            Start Time (seconds or mm:ss)
            <input type="text" id="editStartTime" placeholder="30 or 0:30" style="width: 100%; padding: 8px; border: 1px solid var(--burnt); border-radius: 6px; font-family: inherit;" />
          </label>
          <button id="testYoutubeBtn" class="btn" style="width: 100%; margin-top: 8px;">â–¶ï¸ Test Playback</button>
          <div id="youtubeSuggestion" style="display: none; margin-top: 12px; padding: 12px; background: #f0f4f8; border-radius: 6px; border: 1px solid var(--accent);">
            <div style="font-size: 14px; font-weight: bold; margin-bottom: 8px; color: var(--accent);">ğŸ’¡ Karaoke Suggestion</div>
            <div id="youtubeSuggestionText" style="font-size: 13px; color: var(--ink); margin-bottom: 8px;"></div>
            <button id="youtubeSearchBtn" class="btn" style="width: 100%; background: #ff0000; color: white; font-size: 14px;">ğŸ” Search YouTube for Karaoke</button>
          </div>
        </div>
      </div>
      <div class="modal__footer">
        <button id="saveEditBtn" class="btn">Save</button>
        <button id="cancelEditBtn" class="btn">Cancel</button>
        <button id="deleteEditBtn" class="btn" style="background: #c44; color: white; display: none;">Delete</button>
      </div>
    </div>
  </div>

  <script src="script.js?v=10"></script>
</body>
</html>
